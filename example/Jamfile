#
# Copyright (c) 2019-2023 Ruben Perez Hidalgo (rubenperez038 at gmail dot com)
#
# Distributed under the Boost Software License, Version 1.0. (See accompanying
# file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#

import os ;

path-constant this_dir : . ;

# The hostname to use for examples
local hostname = [ os.environ BOOST_MYSQL_SERVER_HOST ] ;
if $(hostname) = ""
{
    hostname = "localhost" ;
}

# Example list
local regular_examples =
    snippets
    tutorial
    text_queries
    prepared_statements
    async_callbacks
    async_coroutines
    async_coroutinescpp20
    async_futures
    default_completion_tokens
    metadata
    ssl
    timeouts
;

for local example in $(regular_examples)
{
    local example_name = "boost_mysql_example_$(example)" ;
    unit-test $(example_name)
        :
            "$(example).cpp"
            /boost/mysql/test//mysql
            /boost/context//boost_context
        :
            <testing.arg>"example_user example_password $(hostname)"
        ;
}

# UNIX. Honor BOOST_MYSQL_NO_UNIX_SOCKET_TESTS for homogeneity with cmake
if [ os.environ BOOST_MYSQL_NO_UNIX_SOCKET_TESTS ] = "" {
    unit-test boost_mysql_example_unix_socket
    :
        unix_socket.cpp
        /boost/mysql/test//mysql
    :
        <testing.arg>"example_user example_password"
    ;
}

# Stored procedures. The example is a command line tool that must be run
# several times in order, so we do this through a Python script
unit-test boost_mysql_example_stored_procedures
    :
        stored_procedures.cpp
        /boost/mysql/test//mysql
    : requirements
        <testing.launcher>"python $(this_dir)/private/run_stored_procedures.py"
        <testing.arg>$(hostname)
    ;


# Source script. unit-test doesn't support input-file correctly
unit-test boost_mysql_example_source_script
    :
        source_script.cpp
        /boost/mysql/test//mysql
    : requirements
        <testing.arg>"example_user example_password $(hostname) $(this_dir)/private/test_script.sql"
    ;
